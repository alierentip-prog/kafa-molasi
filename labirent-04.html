<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Labirent – Gerçeklik Koridoru</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#000;}
#subtitle{
  position:absolute;bottom:8%;width:100%;text-align:center;
  color:#f2e6d2;font-family:"Poppins",sans-serif;font-size:1.15rem;
  opacity:0;transition:opacity 2s ease;
  text-shadow:0 0 18px rgba(255,220,150,0.8);
}
#fadeWhite{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:white;opacity:0;transition:opacity 3s ease;
}
</style>
</head>
<body>
<div id="subtitle"></div>
<div id="fadeWhite"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* === SAHNE KURULUMU === */
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000, 0.035);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* === IŞIKLAR === */
const torch = new THREE.PointLight(0xffa060, 2.2, 20);
torch.castShadow = true;
scene.add(torch);
scene.add(new THREE.AmbientLight(0x202010,0.5));

/* === DOKULAR === */
const loader = new THREE.TextureLoader();
const stone = loader.load("https://i.imgur.com/mN6ThvY.jpeg");
stone.wrapS = stone.wrapT = THREE.RepeatWrapping;
stone.repeat.set(1,1);
const wallMat = new THREE.MeshStandardMaterial({map:stone,roughness:1,metalness:0.1});
const floorMat = new THREE.MeshStandardMaterial({color:0x151515,roughness:0.8});

/* === TÜNEL SEGMENTLERİ === */
const SEGMENT_LEN = 40;
const PATH = [
  {turn:"forward", len:25},
  {turn:"right", len:20},
  {turn:"forward", len:25},
  {turn:"left", len:20},
  {turn:"forward", len:30},
  {turn:"right", len:15},
  {turn:"forward", len:20}
];

let zOffset = 0;
for(let p=0;p<PATH.length;p++){
  const seg = PATH[p];
  const dir = seg.turn;
  for(let i=0;i<seg.len;i++){
    const xShift = dir==="left" ? -i*0.3 : dir==="right" ? i*0.3 : 0;
    const left = new THREE.Mesh(new THREE.BoxGeometry(1,4,4), wallMat);
    left.position.set(-4+xShift,0,-zOffset);
    scene.add(left);
    const right = new THREE.Mesh(new THREE.BoxGeometry(1,4,4), wallMat);
    right.position.set(4+xShift,0,-zOffset);
    scene.add(right);
    const top = new THREE.Mesh(new THREE.BoxGeometry(8,1,4), wallMat);
    top.position.set(xShift,2,-zOffset);
    scene.add(top);
    const bottom = new THREE.Mesh(new THREE.BoxGeometry(8,1,4), floorMat);
    bottom.position.set(xShift,-2,-zOffset);
    scene.add(bottom);
    zOffset += 4;
  }
}

/* === DUVAR YAZILARI === */
const words=["GERÇEKLİK","YANSIMA","BEN KİMİM?","BİLİNÇ","KORKU","SUSKUNLUK","UYANIŞ","ZAMAN","GÖLGE","RUH","UNUTUŞ","UYAN"];
function makeTextCanvas(text){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=512; canvas.height=128;
  ctx.fillStyle='black'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font='bold 60px Poppins';
  ctx.fillStyle='orange';
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(text,canvas.width/2,canvas.height/2);
  return new THREE.CanvasTexture(canvas);
}
for(let i=0;i<words.length;i++){
  const tex=makeTextCanvas(words[i]);
  const mat=new THREE.MeshBasicMaterial({map:tex,transparent:true});
  const plane=new THREE.Mesh(new THREE.PlaneGeometry(3,0.7),mat);
  const side=(i%2===0?-3.3:3.3);
  plane.position.set(side,0.5,-i*20);
  plane.rotation.y=i%2===0?Math.PI/2:-Math.PI/2;
  scene.add(plane);
}

/* === ALT YAZILAR === */
const subtitles=[
  "Koridor... sonsuz bir döngü gibi.",
  "Duvarlar seni tanıyor. Her kelime seni izliyor.",
  "Adımların yankısı bile seni yargılıyor.",
  "Bir ışık mı o... yoksa bir yanılsama mı?",
  "Zemin çatlıyor..."
];
const subtitle=document.getElementById("subtitle");
const fadeWhite=document.getElementById("fadeWhite");
let idx=0;
function showNext(){
  if(idx<subtitles.length){
    subtitle.textContent=subtitles[idx];
    subtitle.style.opacity=1;
    setTimeout(()=>{subtitle.style.opacity=0;idx++;setTimeout(showNext,2200);},4000);
  }else collapseGround();
}
setTimeout(showNext,2500);

/* === KAMERA VE HAREKET === */
camera.position.set(0,0,5);
let t=0, quake=false, quakeTime=0;
function animate(){
  requestAnimationFrame(animate);
  t+=0.015;
  camera.position.z -= 0.08;
  camera.position.x = Math.sin(t*2)*0.3; // sağa sola hafif salınım
  torch.position.z = camera.position.z - 2;
  torch.position.x = camera.position.x;
  torch.position.y = 1 + Math.sin(t*3)*0.2;
  if(quake){
    quakeTime += 0.03;
    camera.rotation.x = Math.sin(quakeTime*40)*0.04;
    camera.rotation.y = Math.sin(quakeTime*30)*0.03;
    if(quakeTime > 5){
      fadeWhite.style.opacity=1;
      setTimeout(()=>window.location.href="labirent-05.html",3000);
    }
  }
  renderer.render(scene,camera);
}
animate();

/* === ÇÖKÜŞ === */
function collapseGround(){
  quake=true;
  subtitle.textContent="Zemin... kayıyor!";
  subtitle.style.opacity=1;
}

/* === PENCERE YENİDEN BOYUTLANDI === */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
