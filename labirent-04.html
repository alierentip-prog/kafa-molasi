<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Labirent – Gerçeklik Koridoru</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#000;}
#subtitle{
  position:absolute;bottom:8%;width:100%;text-align:center;
  color:#f2e6d2;font-family:"Poppins",sans-serif;font-size:1.1rem;
  opacity:0;transition:opacity 2s ease;
  text-shadow:0 0 18px rgba(255,220,150,0.8);
}
#fadeWhite{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:white;opacity:0;transition:opacity 3s ease;
}
</style>
</head>
<body>
<div id="subtitle"></div>
<div id="fadeWhite"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.fog=new THREE.FogExp2(0x000000,0.03);
const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// === DOKULAR ===
const loader=new THREE.TextureLoader();
const stone=loader.load("https://i.imgur.com/mN6ThvY.jpeg");
stone.wrapS=stone.wrapT=THREE.RepeatWrapping;
stone.repeat.set(1,1);
const wallMat=new THREE.MeshStandardMaterial({map:stone,roughness:1});
const floorMat=new THREE.MeshStandardMaterial({color:0x202020});

// === IŞIKLAR ===
const torch=new THREE.PointLight(0xffb060,1.8,15);
torch.position.set(0,2,0);
scene.add(torch);
scene.add(new THREE.AmbientLight(0x404030,0.4));

// === TÜNEL ===
const blocks=[];
for(let z=0;z<300;z+=4){
  const left=new THREE.Mesh(new THREE.BoxGeometry(1,4,4),wallMat);
  left.position.set(-4,0,-z);
  scene.add(left);
  const right=new THREE.Mesh(new THREE.BoxGeometry(1,4,4),wallMat);
  right.position.set(4,0,-z);
  scene.add(right);
  const top=new THREE.Mesh(new THREE.BoxGeometry(8,1,4),wallMat);
  top.position.set(0,2,-z);
  scene.add(top);
  const bottom=new THREE.Mesh(new THREE.BoxGeometry(8,1,4),floorMat);
  bottom.position.set(0,-2,-z);
  scene.add(bottom);
  blocks.push(left,right,top,bottom);
}

// === DUVAR YAZILARI ===
const words=["GERÇEKLİK","YANSIMA","BEN KİMİM?","BİLİNÇ","KORKU","SUSKUNLUK","UYANIŞ","ZAMAN","GÖLGE","RUH"];
const texts=[];
const fontLoader=new THREE.FontLoader();
fontLoader.load("https://threejs.org/examples/fonts/helvetiker_regular.typeface.json",font=>{
  for(let i=0;i<words.length;i++){
    const geo=new THREE.TextGeometry(words[i],{font,size:0.4,height:0.05});
    const mat=new THREE.MeshStandardMaterial({color:0xffe08a,emissive:0x302010,emissiveIntensity:0.8});
    const mesh=new THREE.Mesh(geo,mat);
    mesh.position.set((i%2===0?-3.5:2.5),0.5,-i*15);
    mesh.rotation.y=i%2===0?Math.PI/2:-Math.PI/2;
    scene.add(mesh);
    texts.push(mesh);
  }
});

// === ALT YAZILAR ===
const subtitles=[
  "Koridor artık sonsuz görünmüyor.",
  "Duvarlarda kelimeler... kendi kendine parlıyor.",
  "Her dönüşte başka bir kelime, başka bir his.",
  "Yer çatırdıyor..."
];
const subtitle=document.getElementById("subtitle");
const fadeWhite=document.getElementById("fadeWhite");
let idx=0;
function showNext(){
  if(idx<subtitles.length){
    subtitle.textContent=subtitles[idx];
    subtitle.style.opacity=1;
    setTimeout(()=>{subtitle.style.opacity=0;idx++;setTimeout(showNext,1800);},3500);
  }else{
    collapseGround();
  }
}
setTimeout(showNext,2500);

// === KAMERA HAREKETLERİ ===
camera.position.set(0,0,6);
let pathIndex=0;
const turns=[
  {dir:"forward",len:30},
  {dir:"right",len:15},
  {dir:"forward",len:25},
  {dir:"left",len:15},
  {dir:"forward",len:40}
];
let step=0;
let quake=false;
let quakeTime=0;

function moveCamera(){
  if(pathIndex>=turns.length)return;
  const seg=turns[pathIndex];
  if(seg.dir==="forward")camera.position.z-=0.1;
  else if(seg.dir==="right")camera.rotation.y-=0.02;
  else if(seg.dir==="left")camera.rotation.y+=0.02;
  step++;
  if(step>seg.len){
    step=0;
    pathIndex++;
  }
}

function animate(){
  requestAnimationFrame(animate);
  moveCamera();
  torch.position.z=camera.position.z-1;

  texts.forEach((t,i)=>{
    if(Math.abs(t.position.z-camera.position.z)<10){
      t.material.emissiveIntensity=1.2;
    }else t.material.emissiveIntensity=0.4;
  });

  if(quake){
    quakeTime+=0.03;
    camera.rotation.x=Math.sin(quakeTime*30)*0.03;
    camera.rotation.y=Math.sin(quakeTime*25)*0.03;
    if(quakeTime>5){
      fadeWhite.style.opacity=1;
      setTimeout(()=>window.location.href="labirent-05.html",3000);
    }
  }

  renderer.render(scene,camera);
}
animate();

function collapseGround(){
  quake=true;
  subtitle.textContent="Zemin... kayıyor!";
  subtitle.style.opacity=1;
}
</script>
</body>
</html>
