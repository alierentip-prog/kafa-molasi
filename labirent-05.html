<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Labirent 05 | Bilinç Kütüphanesi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #050308;
    font-family: "Poppins", system-ui, -apple-system, sans-serif;
    color: #fdf6e3;
  }

  canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
    z-index: 1;
  }

  #subtitle {
    position: fixed;
    bottom: 12%;
    left: 50%;
    transform: translateX(-50%);
    max-width: 80%;
    text-align: center;
    font-size: 1.05rem;
    line-height: 1.5;
    color: #fdf6e3;
    text-shadow: 0 0 12px rgba(255, 196, 140, 0.9);
    opacity: 0;
    transition: opacity 2s ease;
    z-index: 3;
  }

  #subtitle.visible {
    opacity: 1;
  }

  #whiteout {
    position: fixed;
    inset: 0;
    background: #ffffff;
    opacity: 0;
    z-index: 4;
    pointer-events: none;
    transition: opacity 3.5s ease;
  }

  #finalText {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    text-align: center;
    color: #111827;
    opacity: 0;
    z-index: 5;
    pointer-events: none;
    transition: opacity 2.5s ease 1s;
  }

  #hint {
    position: fixed;
    top: 8%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(248, 250, 252, 0.6);
    z-index: 3;
  }
</style>
</head>
<body>

<canvas id="scene"></canvas>
<div id="hint">BİLİNÇ KÜTÜPHANESİ – SADECE İZLE, GERİSİNİ ZİHNİN HALLEDER</div>
<div id="subtitle"></div>
<div id="whiteout"></div>
<div id="finalText">“Gerçekten buradan çıkmak mı istiyorsun?”</div>

<script>
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

// --- Sahne parametreleri ---
let t = 0;
const shelves = [];
const particles = [];
const texts = [
  "Raflar arasında yürürken, sanki her kitap seni izliyormuş gibi.",
  "Sayfalar açılmadan bile, içinde taşıdığın cümleler var.",
  "Burası bir kütüphane değil sadece; yarım kalmış tüm düşüncelerinin deposu.",
  "Bazı cümleler, hiç yüksek sesle okunmasa da insanı ömür boyu takip eder.",
  "Kapıya yaklaşırken, belki de asıl soruyu ilk kez duyuyorsun: Gerçekten çıkmak istiyor musun?"
];
let currentText = 0;
const subtitleEl = document.getElementById("subtitle");
const whiteout = document.getElementById("whiteout");
const finalText = document.getElementById("finalText");
let textTimer = 0;
let sceneFinished = false;

// --- Raf segmenti üret ---
function makeShelfSegment(depth) {
  return {
    depth,                         // 1 = çok yakın, büyük; 40+ = uzak
    side: Math.random() < 0.5 ? "L" : "R",
    offsetY: (Math.random() - 0.5) * 0.3, // hafif yukarı-aşağı kayma
    tone: 0.6 + Math.random()*0.4
  };
}

// --- İlk rafları doldur ---
for (let i = 0; i < 60; i++) {
  shelves.push(makeShelfSegment(5 + i * 0.8));
}

// --- Toz partikülleri ---
for (let i = 0; i < 130; i++) {
  particles.push({
    x: Math.random(),
    y: Math.random(),
    z: Math.random(),
    speed: 0.003 + Math.random()*0.004,
    size: 0.002 + Math.random()*0.004
  });
}

// --- Altyazı kontrolü ---
function showNextText() {
  if (currentText >= texts.length || sceneFinished) return;
  subtitleEl.textContent = texts[currentText];
  subtitleEl.classList.add("visible");
  setTimeout(() => {
    subtitleEl.classList.remove("visible");
  }, 4000);
  currentText++;
}

setTimeout(showNextText, 2500);       // ilk text
setInterval(showNextText, 9000);      // diğerleri belli aralıklarla

// --- Çizim döngüsü ---
function draw() {
  t += 0.016;
  const w = canvas.width;
  const h = canvas.height;

  // Arka plan – sıcak karanlık geçiş
  const grad = ctx.createRadialGradient(
    w/2, h*0.2, h*0.05,
    w/2, h/2, h*0.9
  );
  grad.addColorStop(0, "#1b120b");
  grad.addColorStop(0.4, "#090509");
  grad.addColorStop(1, "#020009");
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,w,h);

  // Hafif sis
  ctx.fillStyle = "rgba(10, 6, 18, 0.6)";
  ctx.fillRect(0,0,w,h);

  // Toz parçacıkları
  for (const p of particles) {
    p.y -= p.speed;
    if (p.y < -0.1) {
      p.y = 1.1;
      p.x = Math.random();
      p.z = Math.random();
    }
    const depthScale = 0.3 + 0.7 * p.z;
    const px = w * p.x + Math.sin(t*0.3 + p.x*10)*8;
    const py = h * p.y;
    const size = p.size * h * depthScale;
    ctx.fillStyle = "rgba(255, 230, 190, 0.45)";
    ctx.beginPath();
    ctx.arc(px, py, size, 0, Math.PI*2);
    ctx.fill();
  }

  // Rafların hareket hızı
  const speed = 0.18;
  // Raf segmentleri
  for (const s of shelves) {
    s.depth -= speed;
    if (s.depth < 1) {
      s.depth = 55 + Math.random()*10;
      s.side = Math.random() < 0.5 ? "L" : "R";
      s.offsetY = (Math.random()-0.5)*0.3;
      s.tone = 0.6 + Math.random()*0.4;
    }

    const d = s.depth;
    // perspektif ölçek
    const scale = 1 / d;
    const baseWidth = w * 0.22;
    const baseHeight = h * 0.85;
    const shelfWidth = baseWidth * scale;
    const shelfHeight = baseHeight * scale;
    const midY = h * (0.5 + s.offsetY * scale);
    let x;
    if (s.side === "L") {
      x = w * 0.15 - shelfWidth * 0.5;
    } else {
      x = w * 0.85 - shelfWidth * 0.5;
    }
    const y = midY - shelfHeight/2;

    // Raf gövdesi
    const woodGrad = ctx.createLinearGradient(x, y, x + shelfWidth, y + shelfHeight);
    const warm = Math.floor(90 + s.tone*80);
    woodGrad.addColorStop(0, `rgba(${warm+20}, ${70}, ${30}, 0.95)`);
    woodGrad.addColorStop(1, `rgba(${warm-10}, ${50}, ${20}, 0.95)`);
    ctx.fillStyle = woodGrad;
    ctx.fillRect(x, y, shelfWidth, shelfHeight);

    // Kenar çizgi
    ctx.strokeStyle = "rgba(12, 7, 3, 0.8)";
    ctx.lineWidth = 1;
    ctx.strokeRect(x, y, shelfWidth, shelfHeight);

    // Raf katmanları (yatay çizgiler)
    const rows = 6;
    ctx.strokeStyle = "rgba(255, 210, 150, 0.12)";
    ctx.lineWidth = 0.7;
    for (let r = 1; r < rows; r++) {
      const ry = y + (shelfHeight * r / rows);
      ctx.beginPath();
      ctx.moveTo(x + shelfWidth*0.08, ry);
      ctx.lineTo(x + shelfWidth*0.92, ry);
      ctx.stroke();
    }

    // Kitap blokları
    const cols = 5;
    for (let c = 0; c < cols; c++) {
      const bx = x + shelfWidth*0.1 + (c / cols) * shelfWidth*0.75;
      const by = y + shelfHeight*0.18 + (Math.sin(t*0.3 + c*3 + s.depth)*0.03)*shelfHeight;
      const bw = shelfWidth*0.08;
      const bh = shelfHeight*0.12;
      const hue = 20 + c*18;
      ctx.fillStyle = `hsla(${hue}, 50%, ${35 + s.tone*20}%, 0.9)`;
      ctx.fillRect(bx, by, bw, bh);
    }
  }

  // Zemin perspektifi (koridor hissi)
  ctx.strokeStyle = "rgba(255, 210, 160, 0.18)";
  ctx.lineWidth = 1;
  for (let i = 0; i < 12; i++) {
    const ratio = i / 12;
    const y = h * (0.65 + ratio*0.3);
    ctx.beginPath();
    ctx.moveTo(w*0.25, y);
    ctx.lineTo(w*0.75, y);
    ctx.stroke();
  }
  ctx.beginPath();
  ctx.moveTo(w*0.25, h*0.6);
  ctx.lineTo(w*0.5, h*0.95);
  ctx.lineTo(w*0.75, h*0.6);
  ctx.stroke();

  // Ortadaki sıcak ışık sütunu
  const lightGrad = ctx.createRadialGradient(
    w/2, h*0.25, h*0.02,
    w/2, h*0.5, h*0.4
  );
  lightGrad.addColorStop(0, "rgba(255, 230, 180, 0.15)");
  lightGrad.addColorStop(0.4, "rgba(255, 200, 140, 0.08)");
  lightGrad.addColorStop(1, "rgba(0,0,0,0)");
  ctx.fillStyle = lightGrad;
  ctx.fillRect(0,0,w,h);

  // Jitter (hafif kamera titremesi)
  ctx.fillStyle = "rgba(0,0,0,0.06)";
  ctx.fillRect(0,0,w,h);

  // Kapı fazı – zaman ilerledikçe kapı beliriyor
  const doorStart = 33; // saniye civarı
  if (t > doorStart && !sceneFinished) {
    const phase = Math.min((t - doorStart) / 6, 1);
    const doorW = w * 0.16 * (0.9 + phase*0.3);
    const doorH = h * 0.38 * (0.9 + phase*0.3);
    const dx = w/2 - doorW/2;
    const dy = h*0.32 - doorH/2;

    const doorGrad = ctx.createLinearGradient(dx, dy, dx + doorW, dy + doorH);
    doorGrad.addColorStop(0, `rgba(60, 38, 22, ${0.85 + phase*0.1})`);
    doorGrad.addColorStop(0.5, `rgba(92, 63, 32, ${0.95})`);
    doorGrad.addColorStop(1, `rgba(60, 38, 22, ${0.85 + phase*0.1})`);
    ctx.fillStyle = doorGrad;
    ctx.fillRect(dx, dy, doorW, doorH);

    ctx.strokeStyle = "rgba(17,10,5,0.9)";
    ctx.lineWidth = 3;
    ctx.strokeRect(dx, dy, doorW, doorH);

    // Kapı kolu
    const knobX = dx + doorW*0.78;
    const knobY = dy + doorH*0.52;
    const knobGrad = ctx.createRadialGradient(knobX, knobY, 2, knobX, knobY, 16);
    knobGrad.addColorStop(0, "#f5e0a0");
    knobGrad.addColorStop(1, "#7a5a29");
    ctx.fillStyle = knobGrad;
    ctx.beginPath();
    ctx.arc(knobX, knobY, doorW*0.04, 0, Math.PI*2);
    ctx.fill();

    // Kapı aralığından ışık
    const slitGrad = ctx.createLinearGradient(dx+doorW*0.49, dy, dx+doorW*0.51, dy+doorH);
    slitGrad.addColorStop(0, "rgba(255,255,255,0)");
    slitGrad.addColorStop(0.3, `rgba(255,255,255,${0.3 + phase*0.4})`);
    slitGrad.addColorStop(0.7, `rgba(255,255,255,${0.3 + phase*0.4})`);
    slitGrad.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle = slitGrad;
    ctx.fillRect(dx+doorW*0.47, dy, doorW*0.06, doorH);

    // Tam parlama → whiteout
    if (phase >= 1 && !sceneFinished) {
      sceneFinished = true;
      setTimeout(() => {
        whiteout.style.opacity = "1";
        setTimeout(() => {
          finalText.style.opacity = "1";
        }, 1500);
      }, 1000);
    }
  }

  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
