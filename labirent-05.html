<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bilinç Odası – Gerçek Sahne</title>
<style>
  html, body { margin:0; height:100%; overflow:hidden; background:#000; font-family:'Poppins', sans-serif; }
  #subtitle {
    position: absolute;
    bottom: 40px;
    width: 100%;
    text-align: center;
    color: rgba(255,255,255,0.9);
    font-size: 1.2rem;
    letter-spacing: 0.5px;
    text-shadow: 0 0 15px #ffb070;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
  }
  canvas { display: block; }
</style>
</head>
<body>
<div id="subtitle"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
// === SAHNE KURULUMU ===
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// === IŞIKLAR ===
const ambient = new THREE.AmbientLight(0x302010, 0.3);
scene.add(ambient);
const torchLight = new THREE.PointLight(0xffa050, 2, 25);
torchLight.position.set(0,4,0);
torchLight.castShadow = true;
scene.add(torchLight);

// === DOKULAR ===
const loader = new THREE.TextureLoader();
const tex = {
  wood: loader.load("https://cdn.jsdelivr.net/gh/KaizIQ/textures/minecraft/wood_planks_oak.png"),
  stone: loader.load("https://cdn.jsdelivr.net/gh/KaizIQ/textures/minecraft/stone_bricks.png"),
  book: loader.load("https://cdn.jsdelivr.net/gh/KaizIQ/textures/minecraft/bookshelf.png"),
  door: loader.load("https://cdn.jsdelivr.net/gh/KaizIQ/textures/minecraft/door_oak.png")
};
for(let t in tex){ tex[t].wrapS = tex[t].wrapT = THREE.RepeatWrapping; }

// === MALZEMELER ===
const woodMat = new THREE.MeshStandardMaterial({map:tex.wood});
const stoneMat = new THREE.MeshStandardMaterial({map:tex.stone});
const bookMat = new THREE.MeshStandardMaterial({map:tex.book});

// === ZEMİN & DUVARLAR ===
const floor = new THREE.Mesh(new THREE.BoxGeometry(30,1,30), stoneMat);
floor.position.y = -2;
floor.receiveShadow = true;
scene.add(floor);
const ceiling = new THREE.Mesh(new THREE.BoxGeometry(30,1,30), woodMat);
ceiling.position.y = 6;
scene.add(ceiling);

const wallData = [
  {x:0,y:2,z:-15,geo:[30,8,1]},
  {x:0,y:2,z:15,geo:[30,8,1]},
  {x:-15,y:2,z:0,geo:[1,8,30]},
  {x:15,y:2,z:0,geo:[1,8,30]}
];
wallData.forEach(p=>{
  const wall = new THREE.Mesh(new THREE.BoxGeometry(...p.geo), woodMat);
  wall.position.set(p.x,p.y,p.z);
  wall.castShadow = true;
  wall.receiveShadow = true;
  scene.add(wall);
});

// === KİTAPLIKLAR ===
for(let i=-10;i<=10;i+=5){
  const shelf = new THREE.Mesh(new THREE.BoxGeometry(4,5,1), bookMat);
  shelf.position.set(i,0,-14.5);
  scene.add(shelf);
}

// === KAPI ===
const door = new THREE.Mesh(new THREE.BoxGeometry(3,6,0.5), new THREE.MeshStandardMaterial({map:tex.door}));
door.position.set(0,0,14.75);
door.castShadow = true;
scene.add(door);

// === MEŞALELER ===
for(let i=-10;i<=10;i+=10){
  const torch = new THREE.PointLight(0xffa040, 2, 10);
  torch.position.set(i,3,-14);
  scene.add(torch);
}

// === KAMERA BAŞLANGIÇ ===
camera.position.set(0,1.6,10);
let clock = new THREE.Clock();
let doorOpening = false;

// === ALT YAZILAR ===
const subtitles = [
  "Bir şey... seni çağırıyor.",
  "Kitapların arasında yankılanan bir nefes gibi...",
  "Duvarlar geçmişi fısıldıyor.",
  "Bir adım daha at. Korkma.",
  "Kapı... seni bekliyor."
];
let currentSubtitle = 0;
const subtitleEl = document.getElementById("subtitle");

function showSubtitle(text) {
  subtitleEl.textContent = text;
  subtitleEl.style.opacity = 1;
  setTimeout(() => { subtitleEl.style.opacity = 0; }, 4000);
}
setTimeout(()=>showSubtitle(subtitles[currentSubtitle++]), 2000);
setInterval(()=>{
  if(currentSubtitle < subtitles.length){
    showSubtitle(subtitles[currentSubtitle++]);
  } else if(!doorOpening){
    doorOpening = true;
    openDoor();
  }
}, 7000);

// === KAPI AÇILMA ANİMASYONU ===
let doorAngle = 0;
function openDoor(){
  const openInterval = setInterval(()=>{
    door.rotation.y -= 0.05;
    doorAngle += 0.05;
    if(doorAngle > Math.PI/2){
      clearInterval(openInterval);
      setTimeout(()=>window.location.href="labirent-06.html", 3000);
    }
  },50);
  showSubtitle("Kapı açılıyor...");
}

// === ANİMASYON ===
function animate(){
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();
  torchLight.intensity = 1.8 + Math.sin(t*5)*0.3;
  camera.position.z -= 0.015;
  if(camera.position.z < -13) camera.position.z = 10;
  camera.lookAt(0,1.5,-14);
  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
